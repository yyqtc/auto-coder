# 技术参考

## LECL 链创建

plan_model = ChatOpenAI(
    model="qwen-max",
    openai_api_key=config["QWEN_API_KEY"],
    openai_api_base=config["QWEN_API_BASE"],
    temperature=0.7
).with_structured_output(Plan)

plan_prompt = ChatPromptTemplate.from_messages([
    (
        "system",
        """
            你是一位非常专业的需求分析专家，善于分析需求并给出执行计划。
            注意！
            1. 你必须默认项目文件夹已经被创建了！
            2. 你必须知道执行你计划的团队的能力包括：分析项目代码、编写代码和文档、创建文件夹、删除文件夹或文件、扫描项目目录和阅读需求文档。他们无法执行超出他们能力范围的命令！
            3. 他们非常的忙！所以必须把任务中他们需要知道的信息明确地告诉他们！不要让他们去猜！让他们能够快速完成任务！
            4. 你输出的计划内的步骤应该是相互独立的、可以与需求点一一对应的！
            5. 不要反复的创建删除同一个文件或目录！
            6. 确保计划中的每一个步骤都能够得到所有需要的信息！
            7. 确保计划的最后一步完成后用户能够得到一个完整可运行的项目！
            8. 如果你认为需要修正计划，请直接返回计划列表，不要返回答案！
        """
    ),
    ("user", "{input}")
])

agent = plan_prompt | plan_model

## agent创建

_model = ChatOpenAI(
        model="qwen-plus",
        openai_api_key=config["QWEN_API_KEY"],
        openai_api_base=config["QWEN_API_BASE"],
        temperature=0.7
    )

    _prompt = f"""
        你是一位非常负责的审核员，我需要你根据需求文档和项目开发日志，检查项目是否实现了需求文档中的所有功能。
    """

    agent = create_agent(
        model=_model,
        system_prompt=_prompt,
        tools=tools,
        response_format=Act
    )

## 工具申明

from langchain.tools import tool

@tool
def search_todo_dir(file_name: str) -> List[str]:
    """
        可以浏览需求目录下所有文件的助手，告诉他文件名，他会在todo目录下搜索文件，如果文件存在，返回文件内容，否则返回文件不存在。
        Args:
            file_name: 要搜索的文件名

        Returns:
            如果文件存在，返回文件内容
            如果文件不存在，返回“文件不存在”
    """
    if not os.path.exists(f"{project_path}/todo/{config['PROJECT_NAME']}/{file_name}"):
        return "文件不存在"
    
    with open(f"{project_path}/todo/{config['PROJECT_NAME']}/{file_name}", "r", encoding="utf-8") as f:
        return f.read()