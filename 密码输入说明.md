# Python 执行需要密码的命令

## 问题说明

当需要在 Python 中执行需要密码的命令（如 `sudo -i`）时，有几种方法：

## 解决方案

### 方法1: 使用 `sudo -S`（推荐）

`-S` 选项让 sudo 从标准输入读取密码。

```python
def execute_with_password(command, password):
    # 将 sudo 替换为 sudo -S
    modified_command = command.replace('sudo ', 'sudo -S ', 1)
    
    process = subprocess.Popen(
        ['bash', '-c', modified_command],
        stdin=subprocess.PIPE,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE,
        text=True
    )
    
    # 发送密码
    stdout, stderr = process.communicate(input=password + '\n')
```

### 方法2: 使用 pexpect（更强大）

pexpect 库可以处理更复杂的交互式场景。

```bash
pip install pexpect
```

```python
import pexpect

child = pexpect.spawn('sudo -i')
child.expect('password:')
child.sendline(password)
child.expect(pexpect.EOF)
```

## 使用示例

### 示例1: 执行需要密码的单个命令

```python
execute_with_password("sudo apt-get update", password="your_password")
```

### 示例2: 执行脚本中的 root 命令

脚本内容 (`script.sh`):
```bash
root -i
cursor-agent -p "在test.py写一段废话"
```

Python 代码会自动：
1. 检测到 `root -i` 或 `sudo -i`
2. 提示输入密码（或从配置读取）
3. 在 root shell 中执行后续命令

```python
execute_shell_script_with_password("./script/script.sh", password=None)
```

## 安全性建议

1. **不要硬编码密码**：使用 `getpass.getpass()` 或在配置文件中加密存储
2. **使用环境变量**：可以通过环境变量传递敏感信息
3. **考虑使用 sudoers NOPASSWD**：对于自动化脚本，可以配置 sudoers 文件

## 配置密码（可选）

可以在 `config.json` 中添加密码：

```json
{
    "CURSOR_API_KEY": "...",
    "SUDO_PASSWORD": "your_password"
}
```

然后在代码中读取：

```python
password = config.get("SUDO_PASSWORD")
```

**⚠️ 注意**: 不要在代码仓库中提交包含密码的配置文件！

